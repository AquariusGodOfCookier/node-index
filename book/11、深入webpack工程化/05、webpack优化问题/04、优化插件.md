## 优化插件

### SplitChunks
动态加载的模块打包成common chunks，它的作用相当于之前的commonChunksPlugin，但是比之前的插件功能更加强大。
因为几乎所有的项目打包都必备，所以webpack直接内置为一个配置，配置在
[optimization](https://webpack.docschina.org/plugins/split-chunks-plugin/#src/components/Sidebar/Sidebar.jsx)
这个选项下。下面我们看下默认的配置：
```
splitChunks: {
  chunks: 'async', // 分割异步模块
  minSize: 30000, // 分割的文件最小大小
  maxSize: 0,     
  minChunks: 1, // 引用次数
  maxAsyncRequests: 5, // 最大异步请求数
  maxInitialRequests: 3, // 最大初始化请求数
  automaticNameDelimiter: '~', // 抽离的命名分隔符
  automaticNameMaxLength: 30, // 名字最大长度
  name: true,
  cacheGroups: { // 缓存组
    vendors: { // 先抽离第三方库
      test: /[\\/]node_modules[\\/]/,
      priority: -10
    },
    default: { 
      minChunks: 2,
      priority: -20, // 优先级
      reuseExistingChunk: true
    }
  }
}
```
使用cacheGroups我们可以任意定制我们想打包的common chunk，还可以控制每个chunk的大小，默认配置已经满足大多数开发的需求。

### DllPlugin && DllReferencePlugin
接下来要介绍的是DllPlugin和DllReferencePlugin的结合，这两个插件必须配合使用才能发挥其巨大的作用，主要的作用是提升你开发时的构建速度。它的思路是这样的，首先使用DllPlugin预编译所有你项目中几乎不会变化的外部模块，然后在构建之前，把这些资源打包成一个vendor，之后直接在项目中使用，每次修改文件这些资源将不用重新打包

webpack.dll.js：
```
const path = require('path');
const DllPlugin = require('webpack/lib/DllPlugin');

module.exports = {
    entry:['vue','vue-router', 'vuex'],
    mode:'production',
    output:{
        filename:'vue.dll.js',
        path:path.resolve(__dirname,'dll'),
        library:'vue'
    },
    plugins:[
        new DllPlugin({
            name:'vue',
            path:path.resolve(__dirname,'dll/manifest.json')
        })
    ]
}
```


执行webpack --config webpack.dll.js命令 ，我们将看到生成的dll目录下有两个文件：vue.dll.js和manifest.json ，manifest.json中保存了我们打包到vue.dll.js中的模块路径，然后接下来我们需要使用DllReferencePlugin插件通过manifest.json文件去找我们需要的依赖：

```
const DllReferencePlugin = require('webpack/lib/DllReferencePlugin');
const AddAssetHtmlWebpackPlugin = require('add-asset-html-webpack-plugin');
// 构建时会引用动态链接库的内容
new DllReferencePlugin({
  manifest:path.resolve(__dirname,'dll/manifest.json')
}),
// 通过插件将vue.dll.js自动引入到我们的index.html中
new AddAssetHtmlWebpackPlugin(
  { filepath: path.resolve(__dirname,'dll/vue.dll.js') }
)
```

### 参考文章
- [十大webpack优化插件](https://juejin.im/post/5d89bd555188250972229c66)
