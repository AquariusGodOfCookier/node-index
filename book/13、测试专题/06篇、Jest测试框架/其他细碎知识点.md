## 其他细碎知识点


### 设置超时时间
afterAll(fn, timeout)、afterEach(fn, timeout)、test(name, fn, timeout) 等价于 it(name, fn, timeout)

这里可以参看这个文章：
- [https://www.cnblogs.com/Wolfmanlq/p/8032278.html](https://www.cnblogs.com/Wolfmanlq/p/8032278.html)


### 关于sessionStorage和localStorage的测试
在jest的最新版本中， 其实已经通过jsdom模拟了 sessionStorage和localStorage 的实现                 
然后测试的时候， 需要做异步存储， 要不然是不能获取到 存入的值。                   
例如有这样一个方法： 
```js
const sessionStore = {
  get(k) {
    let ret = window.sessionStorage.getItem(k);
    try {
      ret = JSON.parse(ret);
    } catch (e) { console.log(e); }
    return ret;
  },
  set(k, val) {
    let value = val;
    try {
      value = JSON.stringify(val);
    } catch (e) { console.log(e); }
    window.sessionStorage.setItem(k, value);
  },
};
```
我们写测试用例的时候， 可以这样写：
```js
  describe('sessionStore', () => {
    it('set 方法', async (done) => {
      await expect(sessionStore.set('name', 'yanle'));
      done();
    });
    it('get 方法', (done) => {
      done();
      expect(sessionStore.get('name')).toBe('yanle');
    });
  });
```


### 测试中忽略样式和图片方式
在配置jest.config.js中加上这两句
```js
  moduleNameMapper: {
    '^.+\\.(css|less)$': '<rootDir>/test/cssTransform.js',
    '\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':
      '<rootDir>/test/fileTransform.js',
  },
```

然后对应文件分别为：
cssTransform.js：                
```js
module.exports = {};
```

fileTransform.js：                   
```js
module.exports = 'test-file-stub';
```

### 测试中关于antd组件报undefined的问题
这个情况只会出现在 生成覆盖文件时候会产生                       
![img](./img/1.png)

这个问题不是个例， antd issue 里面有很多这种情况的讨论。
- [无法找到Layout，为undefined](https://github.com/ant-design/ant-design/issues/4618)
- [启用按需加载后报错 提示Menu is not defined](https://github.com/ant-design/babel-plugin-import/issues/172)

解决办法：               
1、在.babelrc 文件里面 删除import-plugin 配置
```
{
  "passPerPreset": true,
  "plugins": [
    "relay",
    "transform-runtime",       
    **["import", {"libraryName": "antd", "style": "css"}]**
  ],
  "presets": [
    "react",                   
    "es2015",                  
    "stage-0"
  ]
} 
```

2、关闭webpack react生产模式核心压缩功能即不会报错                    
remove these：               
```
new webpack.DefinePlugin({
    "process.env": {
    NODE_ENV: JSON.stringify("production")
    }
});
```

3、获取组件不要用解构
ReferenceError: Layout is not defined
```js
import { Menu } from 'antd';
const { Item } = Menu;
```

While：All fine...
```js
import { Menu } from 'antd';
const Item = Menu.Item;
```


### 需要整理jest.mock()
